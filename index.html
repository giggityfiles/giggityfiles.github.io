<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Giggity Files</title>
  <link href="https://fonts.googleapis.com/css2?family=Oswald&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Oswald', sans-serif;
      background: #111;
      color: #fff;
      margin: 0;
      padding: 0;
    }
    header {
      background: #b30000;
      padding: 20px;
      text-align: center;
      border-bottom: 4px solid #ffcc00;
    }
    header h1 {
      margin: 0;
      font-size: 2.5em;
      color: #ffcc00;
      text-shadow: 2px 2px 0 #000;
    }
    #repos, #files {
      padding: 20px;
    }
    a {
      color: #0af;
      text-decoration: none;
      font-weight: bold;
    }
    a:hover {
      text-decoration: underline;
    }
    ul {
      list-style: none;
      padding-left: 20px;
    }
    li {
      margin: 8px 0;
      display: flex;
      align-items: center;
    }
    li img {
      width: 18px;
      height: 18px;
      margin-right: 8px;
    }
    .breadcrumbs {
      margin: 10px 0;
      font-size: 0.9em;
      font-weight: bold;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 4px;
    }
    .breadcrumbs img {
      width: 16px;
      height: 16px;
      margin-right: 4px;
    }
    .breadcrumbs a {
      color: #ffcc00;
    }
    footer {
      margin-top: 30px;
      padding: 15px;
      background: #222;
      text-align: center;
      font-size: 0.9em;
      color: #ccc;
      border-top: 3px solid #b30000;
    }
  </style>
</head>
<body>
  <header>
    <h1>Giggity Files</h1>
    <p>“Giggity!” — Glenn Quagmire</p>
  </header>

  <div id="repos"></div>
  <div id="files"></div>

  <footer>
    ⚠️ Note: Some Windows applications may not work properly on macOS, Android, or Linux without using Wine or similar compatibility layers.  
  </footer>

  <script>
    const user = "giggityfiles";
    const iconURL = "https://img.icons8.com/?size=256&id=1u78UgAkC1bw&format=png";

    async function listRepos() {
      const res = await fetch(`https://api.github.com/users/${user}/repos`);
      const repos = await res.json();
      const reposDiv = document.getElementById("repos");

      const ul = document.createElement("ul");

      // Add "main" manually (point to giggityfiles.github.io)
      const mainLi = document.createElement("li");
      const mainIcon = document.createElement("img");
      mainIcon.src = iconURL;
      const mainLink = document.createElement("a");
      mainLink.href = "#";
      mainLink.textContent = "giggityfiles.github.io";
      mainLink.onclick = () => listFiles("main", "");
      mainLi.appendChild(mainIcon);
      mainLi.appendChild(mainLink);
      ul.appendChild(mainLi);

      repos.forEach(repo => {
        if (repo.name === `${user}.github.io`) return; // skip pages repo
        const li = document.createElement("li");
        const icon = document.createElement("img");
        icon.src = iconURL;
        const a = document.createElement("a");
        a.href = "#";
        a.textContent = repo.name;
        a.onclick = () => listFiles(repo.name, "");
        li.appendChild(icon);
        li.appendChild(a);
        ul.appendChild(li);
      });

      reposDiv.innerHTML = "<h2>Repositories</h2>";
      reposDiv.appendChild(ul);
    }

    function renderBreadcrumbs(repo, path) {
      const filesDiv = document.getElementById("files");
      const parts = path.split("/").filter(Boolean);

      const breadcrumbDiv = document.createElement("div");
      breadcrumbDiv.className = "breadcrumbs";

      // repo root
      const repoIcon = document.createElement("img");
      repoIcon.src = iconURL;
      const repoLink = document.createElement("a");
      repoLink.href = "#";
      repoLink.textContent = repo;
      repoLink.onclick = () => listFiles(repo, "");
      breadcrumbDiv.appendChild(repoIcon);
      breadcrumbDiv.appendChild(repoLink);

      let currentPath = "";
      parts.forEach((part) => {
        breadcrumbDiv.appendChild(document.createTextNode(" / "));

        const icon = document.createElement("img");
        icon.src = iconURL;
        breadcrumbDiv.appendChild(icon);

        const partLink = document.createElement("a");
        partLink.href = "#";
        partLink.textContent = part;
        currentPath += part + "/";
        partLink.onclick = () => listFiles(repo, currentPath);
        breadcrumbDiv.appendChild(partLink);
      });

      filesDiv.appendChild(breadcrumbDiv);
    }

    async function listFiles(repo, path) {
      let apiURL;
      if (repo === "main") {
        apiURL = `https://api.github.com/repos/${user}/${user}.github.io/contents/file/${path}`;
      } else {
        apiURL = `https://api.github.com/repos/${user}/${repo}/contents/${path}`;
      }

      const res = await fetch(apiURL);
      const data = await res.json();
      const filesDiv = document.getElementById("files");
      filesDiv.innerHTML = "<h2>Files in " + repo + "/" + path + "</h2>";

      // Breadcrumbs
      renderBreadcrumbs(repo, path);

      // If API returned an error object
      if (!Array.isArray(data)) {
        filesDiv.innerHTML += `<p style="color:red">Error: ${data.message || "Unknown error"}</p>`;
        return;
      }

      const ul = document.createElement("ul");

      // add dirs
      data.filter(item => item.type === "dir").forEach(d => {
        const li = document.createElement("li");
        const icon = document.createElement("img");
        icon.src = iconURL;
        li.appendChild(icon);

        const dirname = document.createElement("a");
        dirname.href = "#";
        dirname.style.fontWeight = "bold";
        dirname.textContent = d.name;
        dirname.onclick = () => listFiles(repo, path + d.name + "/");
        li.appendChild(dirname);

        ul.appendChild(li);
      });

      // add files
      data.filter(item => item.type === "file").forEach(f => {
        const li = document.createElement("li");
        const icon = document.createElement("img");
        icon.src = iconURL;
        li.appendChild(icon);

        const filename = document.createElement("span");
        filename.style.fontWeight = "bold";
        filename.textContent = f.name;
        li.appendChild(filename);

        const open = document.createElement("a");
        if (repo === "main") {
          open.href = `https://giggityfiles.github.io/file/${path}${f.name}`;
        } else {
          open.href = `https://giggityfiles.github.io/${repo}/${path}${f.name}`;
        }
        open.textContent = " [Download]";
        open.setAttribute("download", f.name);

        li.appendChild(open);
        ul.appendChild(li);
      });

      filesDiv.appendChild(ul);
    }

    listRepos();
  </script>
</body>
</html>
