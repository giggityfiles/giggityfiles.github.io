<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Giggity Files</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto&family=Oswald&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Oswald', sans-serif;
      background: #111;
      color: #fff;
      margin: 0;
      padding: 0;
    }
    header {
      background: #b30000;
      padding: 20px;
      text-align: center;
      border-bottom: 4px solid #ffcc00;
    }
    header h1 {
      margin: 0;
      font-size: 2.5em;
      color: #ffcc00;
      text-shadow: 2px 2px 0 #000;
    }
    #quote {
      margin: 10px 0;
      font-style: italic;
    }
    #quote.plankton {
      color: #e0e0e0;
      text-shadow: 1px 1px 2px #000;
    }
    #quote.plankton-red {
      color: #ff4444;
    }
    #repos, #files {
      padding: 20px;
    }
    a {
      color: #0af;
      text-decoration: none;
      font-weight: bold;
      cursor: pointer;
    }
    a:hover {
      text-decoration: underline;
    }
    ul {
      list-style: none;
      padding-left: 0;
    }
    li {
      margin: 8px 0;
      display: flex;
      align-items: center;
    }
    li img {
      width: 18px;
      height: 18px;
      margin-right: 8px;
    }
    .breadcrumbs {
      margin: 10px 0;
      font-size: 0.9em;
      font-weight: bold;
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 4px;
    }
    .breadcrumbs a {
      color: #ffcc00;
    }
    button.download {
      background: #ffcc00;
      color: #000;
      border: none;
      padding: 5px 10px;
      margin-left: auto;
      cursor: pointer;
      font-weight: bold;
    }
    button.download:hover {
      background: #ffaa00;
    }
    footer {
      margin-top: 30px;
      padding: 15px;
      background: #222;
      text-align: center;
      font-size: 0.9em;
      color: #ccc;
      border-top: 3px solid #b30000;
    }
    .roboto {
      font-family: 'Roboto', sans-serif !important;
    }
  </style>
</head>
<body>
  <header>
    <h1>Giggity Files</h1>
    <div id="quote" class="plankton"></div>
  </header>

  <div id="repos"></div>
  <div id="files"></div>

  <footer>
    Note: Some Windows apps might not work on macOS, Android, or Linux without Wine.
  </footer>

  <script>
    // Maintenance redirect with cache-buster
    fetch('/maintenance.txt?cb=' + Date.now())
      .then(r => r.text())
      .then(txt => {
        if (txt.trim().toLowerCase() === 'true') {
          window.location.href = 'https://giggityfiles.github.io/maintenance.html';
        }
      })
      .catch(console.error);

    // Quotes arrays
    const commonQuotes = [
      "Giggity giggity goo!",
      "Alright!",
      "Heh heh, oh yeah!",
      "Giggity, let's do it!",
      "You know what time it is... Giggity time!",
      "Yeah, baby! Giggity!",
      "Who else but Quagmire?",
      "Oh, yeah. Giggity.",
      "Ready for action, giggity!"
    ];
    const rareQuotes = [
      "Peter: Freakin' sweet!",
      "Cleveland: Oh, that's nasty.",
      "Joe: Bring it on!",
      "Peter: Lois, I invented 'Giggity'!",
      "Cleveland: I'm just gonna go... over here.",
      "Joe: That's how we roll, partner!",
      "Peter: Hold up now!",
      "Cleveland: My mower hates stairs.",
      "Joe: You guys are crazy, but I love it!"
    ];
    const planktonQuote = "Plankton: Dr. Jr.";

    // Decide quote type
    const quoteEl = document.getElementById('quote');
    const rand = Math.floor(Math.random() * 10000);
    if (rand === 0) {
      quoteEl.textContent = planktonQuote;
      quoteEl.classList.add('plankton-red');
    } else if (rand <= 1) {
      quoteEl.textContent = rareQuotes[Math.floor(Math.random() * rareQuotes.length)];
    } else {
      quoteEl.textContent = commonQuotes[Math.floor(Math.random() * commonQuotes.length)];
    }

    // Randomly apply Roboto to one element, 1 in 10000 chance
    if (Math.floor(Math.random() * 10000) === 0) {
      const allEls = document.querySelectorAll('h1, #quote, #repos, #files, footer');
      const chosen = allEls[Math.floor(Math.random() * allEls.length)];
      chosen.classList.add('roboto');
    }

    // Load repos
    async function loadRepos() {
      const res = await fetch('https://api.github.com/users/giggityfiles/repos');
      const repos = await res.json();
      const html = ['<h2>Repositories</h2><ul>'];
      repos.forEach(repo => {
        if (repo.name.toLowerCase() !== 'giggityfiles.github.io') {
          html.push(`<li><img src="https://img.icons8.com/?size=256&id=1u78UgAkC1bw&format=png"><a onclick="loadFiles('${repo.name}','')">${repo.name}</a></li>`);
        }
      });
      html.push('</ul>');
      document.getElementById('repos').innerHTML = html.join('');
    }

    // Load files
    async function loadFiles(repo, path) {
      const res = await fetch(`https://api.github.com/repos/giggityfiles/${repo}/contents/${path}`);
      const items = await res.json();

      // Breadcrumbs
      const parts = path ? path.split('/') : [];
      const crumbs = [`<a onclick="loadRepos()">Home</a>`];
      let cumPath = '';
      parts.forEach(part => {
        cumPath += part + '/';
        crumbs.push(`<a onclick="loadFiles('${repo}','${cumPath}')">${part}</a>`);
      });

      let html = `<div class="breadcrumbs">${crumbs.join(' / ')}</div><ul>`;
      items.forEach(item => {
        if (item.type === 'dir') {
          html += `<li>
                    <img src="https://img.icons8.com/?size=256&id=1u78UgAkC1bw&format=png">
                    <a onclick="loadFiles('${repo}','${item.path}')">${item.name}</a>
                  </li>`;
        } else {
          html += `<li>
                    <img src="https://img.icons8.com/?size=256&id=1u78UgAkC1bw&format=png">
                    <span>${item.name}</span>
                    <button class="download" onclick="window.open('${item.download_url}')">Download</button>
                  </li>`;
        }
      });
      html += '</ul>';
      document.getElementById('files').innerHTML = html;
    }

    loadRepos();
  </script>
</body>
</html>
